# https

## 出现的原因

`http` 是明文传输，在传递过程中可以被劫持和篡改。
`https` 通过对传递内容进行加密来解决这一问题。

## 加密流程

1. 浏览器发送请求
2. 服务器返回安全证书
3. 浏览器解析安全证书，首先判断是否被篡改，然后去除公钥，生成随机 `key`，并使用公钥加密，发送给服务端
4. 服务器使用私钥解密获取 `key`
5. 服务器与浏览器后续使用 `key` 对通信内容进行加密和解密

## 疑惑

Q1: 为什么先使用非对称加密（公钥私钥）后使用对称加密？

A1:

1. 使用对称加密需要双方经过通信统一密钥 `key`，为了防止 `key` 被中间人获取，所以至少需要一次非对称加密。
1. 如果只有一组公钥和私钥，那么只有一方可以解密。
1. 如果选择两组公钥和私钥呢？
由于非对称加密计算量大，更耗时，
所以最终选择非对称加密传递对称加密需要的密钥。

Q2: 这个方案的漏洞在哪里？

A2:
中间人可以截取并伪造安全证书。

1. 中间商首先截取服务器发送的证书，获取公钥。
1. 然后使用自己的公钥伪造证书，发送给浏览器。
1. 接着浏览器发送被加密的密钥 `key` 。
1. 中间人截取并使用自己的私钥解析 `key` 。
1. 最后使用从服务器获取的公钥对 `key` 加密，发送到服务器。

Q2: 怎么判断安全证书是否被篡改

A2:

1. 有一个专门的机构 `CA` 发布证书，其中包含持有者信息。但是中间商可以只修改证书的公钥部分。
1. 为此，`CA` 使用私钥对证书添加签名，浏览器使用公钥解析证书后，通过验证签名就能知道证书是否被修改。
1. 如果 `CA` 被攻陷，攻击者获取了私钥，`https` 请求就会被截获

## 参考

[接水怪 《大前端进阶 安全》系列 HTTPS详解（通俗易懂）](https://juejin.cn/post/6844904127420432391)
